/**
 * Image Store - Admin gallery script
 *
 * @file gallery.js
 * @package Image Store
 * @author Hafid Trujillo
 * @copyright 20010-2013
 * @filesource  wp-content/plugins/image-store/_js/gallery.js
 * @since 3.0.0
 */

if(typeof uploader=="undefined")var uploader=jQuery("uploader");var post_id=jQuery("#post_ID").val();var uploaderMode=getUserSetting("uploader");ims_image_edit_update=function(e,t){jQuery("#media-item-"+e+" .column-imthumb img").attr("src",t)};jQuery(document).ready(function(e){function n(t,n,r){if(e("li.status-"+t).length<1&&t){e('<li class="status-'+t+'"> <a href="'+imsgal.adminurl+"/post.php?post="+post_id+"&action=edit"+"&status="+t+'">'+n+' <span class="count">(<span>1</span>)</span></a></li>').appendTo(".subsubsub")}else if(t)e("li.status-"+t+" .count span").html(parseInt(e("li.status-"+t+" .count span").text())+1);if(parseInt(e("li.status-"+r+" .count span").text())-1>0)e("li.status-"+r+" .count span").html(parseInt(e("li.status-"+r+" .count span").text())-1);else e("li.status-"+r+"").remove()}function r(){e("#ims_images_box .inside").load(e(this).attr("href")+" #ims_images_box .inside",function(){e("table.sort-images tbody").sortable(t)});return false}cols=e("#ims_images_box thead th:visible").length;var t={axis:"y",cursor:"move",helper:"clone",placeholder:"widget-placeholder",update:function(){i=parseInt(e("input.sort_count").val());e(this).find("tr").each(function(){e(this).find(".column-imorder input").val(i++);if(i%2!=0)e(this).removeClass("alternate").addClass("alternate");else e(this).removeClass("alternate")})}};uploader.bind("FilesAdded",function(t,n){cols=jQuery(".sort-images thead th:visible").length;setTimeout(function(){plupload.each(n,function(t){e("#media-item-"+t.id).wrapInner('<td class="row-remove" colspan="'+cols+'" />')})},30)});uploader.bind("FileUploaded",function(t,n,r){e("#media-item-"+n.id+" .row-remove").remove();if(e("li.status-publish").length<1)e('<li class="status-publish"><a href="'+imsgal.adminurl+"/post.php?post="+post_id+'&action=edit&status=publish">'+postL10n.published+' <span class="count">(<span>1</span>)</span></a></li>').prependTo(".subsubsub");else e("li.status-publish .count span").html(parseInt(jQuery("li.status-publish .count span").text())+1)});uploader.bind("Error",function(t,n){if(!n.message)return;cols=jQuery(".sort-images thead th:visible").length;setTimeout(function(){var t=e("#media-item-"+n.file.id);e("#media-item-"+n.file.id).wrapInner('<td colspan="'+cols+'" />');e("#media-item-"+n.file.id+" .progress").html(n.message).addClass("error")},30)});e("#scannfolder").click(function(){e("#import_folder .loading").show();e("#galleryfolder").removeAttr("disabled")});e(".upload-html-bypass a").click(function(){uploaderMode=0;deleteUserSetting("uploader");e("#html-upload-ui").hide();e("#plupload-upload-ui, #flash-upload-ui").show();return false});e(".upload-flash-bypass a").click(function(){uploaderMode=1;setUserSetting("uploader","1");e("#html-upload-ui").show();e("#plupload-upload-ui, #flash-upload-ui").hide();return false});e("#ims_images_box").delegate(" .sort-images .dismiss","click",function(){e(this).parents(".media-item").slideUp(200,function(){e(this).remove()});return false});e("#ims_images_box").delegate("thead .column-cb [type=checkbox]","click",function(){boxes=e(this).parents(".ims-table").find(".column-cb [type=checkbox]");if(e(this).is(":checked"))boxes.attr("checked","checked");else boxes.removeAttr("checked")});e("#ims_images_box").delegate("a.imstrash","click",function(){e(this).parents("tr").addClass("totrash").fadeIn().fadeOut();e.get(imslocal.imsajax,{action:"editimstatus",status:e(this).attr("name"),_wpnonce:imslocal.nonceajax,imgid:e(this).attr("href").replace("#","")});n("trash",imsgal.trash,"publish");return false});e("#ims_images_box").delegate("a.imsrestore","click",function(){e(this).parents("tr").addClass("restore").fadeIn().fadeOut();e.get(imslocal.imsajax,{action:"editimstatus",status:e(this).attr("name"),_wpnonce:imslocal.nonceajax,imgid:e(this).attr("href").replace("#","")});n("publish",postL10n.published,"trash");return false});e("#ims_images_box").delegate("a.imsdelete","click",function(){e(this).parents("tr").addClass("totrash").fadeIn().fadeOut();e.get(imslocal.imsajax,{parent:post_id,action:"deleteimage",deletefile:imsgal.deletefile,_wpnonce:imslocal.nonceajax,postid:e(this).attr("href").replace("#","")});n(false,postL10n.published,"trash");return false});e("#ims_images_box").delegate("a.imsupdate","click",function(){row=e(this).parents("tr");row.addClass(" doupdate").fadeOut(function(){e(this).removeClass("doupdate")}).fadeIn();e.get(imslocal.imsajax,{action:"upadateimage",_wpnonce:imslocal.nonceajax,caption:row.find("textarea").val(),imgid:e(this).attr("href").replace("#",""),imgtitle:row.find(".column-imtitle input").val(),order:row.find(".column-imorder input").val()});return false});e("table.sort-images tbody").sortable(t);e("#ims_images_box").delegate(".status-trash a","click",r);e("#ims_images_box").delegate(".status-publish a","click",r);e("#ims_images_box").delegate(".tablenav-pages a.page-numbers","click",r);e("#imsexpire").datepicker({altFormat:"yy-m-d",altField:"#_ims_expire",dateFormat:imslocal.dateformat})})