/**
 * Image Store - store functions
 *
 * @file store.js
 * @package Image Store
 * @author Hafid Trujillo
 * @copyright 20010-2013
 * @filesource  wp-content/plugins/image-store/_js/store.js
 * @since 3.2.1
 */
jQuery(function(e){function f(t){i.attr({disabled:"disabled"});u=e(".ims-cart-form").css({opacity:.35});if(t=="no")s.attr({disabled:"disabled"})}var t=[];var n=true;var r=false;var i,s;var o="ims-selected";e.fn.clear_cart_form=function(){return this.each(function(){var t=this.type,n=this.tagName.toLowerCase();if(n=="form")return e(":input",this).clear_cart_form();if(t=="password"||n=="textarea")this.value="";else if(t=="text")this.value=1;else if(t=="checkbox"||t=="radio")this.checked=false;else if(n=="select")this.selectedIndex=0})};var u=e("#ims-pricelist");var a=function(){if(u.is(":visible")){u.hide().appendTo("body");u.find(".ims-message").remove()}var t=e("#"+r);var n=t.find(".touch-shadow");if(!n.is(":visible")){n.show();t.find(".img-metadata").show();e(document).unbind("touch_before_close touch_previous touch_next")}};try{u.hide();if(typeof imstore=="undefined")imstore={};e(".ims-cart-form input[type=hidden]").each(function(){t[e(this).attr("name")]=e(this).attr("data-value-ims");e(this).removeAttr("data-value-ims")});s=e(".ims-cart-form input[name=ims-apply-changes]").bind("click",function(){f();e("input[name=_wpnonce]").val(t["_wpnonce"]);e(".ims-cart-form").attr({method:"post"})});i=e(".ims-cart-form input[type=submit]:not([name=ims-apply-changes])").bind("click",function(){var r=e(this);var i=e(this).attr("name");if(i!="fname")e(".ims-cart-form").attr({method:"post"});for(var s in t)e("input[name='"+s+"']").val(t[s]);if(t["_xmvdata"]>0)e(".ims-cart-form").attr({action:decodeURIComponent(e(this).attr("data-submit-url"))});else e(this).attr({name:"ims-enotification"});if(n){f("no");e(".ims-cart-actions").append('<span class="loading"></span>');e.post(document.location,u.serialize()+"&ims-apply-changes=1&"+e(this).attr("name")+"=1",function(e){n=false;r.removeAttr("disabled");r.trigger("click")});return false}})}catch(l){return false}if(jQuery().imstouch){var c=e(".ims-message");if(e(".add-images-to-cart a")[0]){e(".add-images-to-cart a").imstouch({href:"#ims-pricelist",onOpen:function(){c.hide();count=e(".ims-innerbox input:checked").length;e(".ims-image-count em").html(count);e("#ims-to-cart-ids").val(img_ids_to_string());if(count==0)e(".ims-add-error").show()},onClose:function(){e(".ims-add-error").hide()}})}if(e(".add-images-to-cart-single a")[0]){e(".add-images-to-cart-single a").imstouch({href:"#ims-pricelist",onOpen:function(){if(e("#ims-thumbs li.selected")[0])$ids=e("#ims-thumbs li.selected").attr("data-id");else $ids=e('.img-metadata input[name="imgs[]"]').val();c.hide();e("#ims-to-cart-ids").val($ids)}})}}e(document).bind("touch_open",function(){u.clear_cart_form();e("#touch-slider .ims-slide").unbind("click")});e("body").delegate(".ims-delete [type='checkbox']","click",function(t){$row=e(this).parents(".ims-clear-row");if(e(this).is(":checked")){$row.addClass("ims-checked")}else $row.removeClass("ims-checked")});e("body").delegate('input[name="ims-apply-changes"]',"click",function(t){t.preventDefault();e(this).bind("click",function(){return false});u=e(".ims-cart-form");e(this).after('<span class="loading"></span>');e.post(document.location,u.serialize()+"&ims-apply-changes=1",function(t){if($posted=e(t).find(".ims-cart-form"))document.location.reload(true)})});e("body").delegate('input[name="ims-enotice-checkout"]',"click",function(t){var r=e('input[name="sagepay_url"]');if(!r[0]||!n)return;t.preventDefault();var i=e(this).attr({disabled:"disabled"});var s=e("form.shipping-info").css({opacity:.35});e.post(document.location,s.serialize()+"&ims-enotice-checkout=1",function(t){var o=e(t).find(".ims-message");if(o.has("p"))e(".ims-message").replaceWith(o);s.append(e(t).find("#sagepay-data"));i.removeAttr("disabled");s.attr({action:r.val()});n=false;i.trigger("click")})});e("body").delegate('input[name="ims-add-to-cart"]',"click",function(t){t.preventDefault();var n=e(this);u.find(".ims-message").remove();u.find(".ims-image-sizes").css({opacity:.3});$submitdiv=e("#ims-pricelist .ims-submit").addClass("loading");n.attr({disabled:"disabled"});e.post(document.location,u.serialize()+"&ims-add-to-cart=1",function(t){e("#ims-pricelist").clear_cart_form();u.find(".ims-image-sizes").css({opacity:1});e(".ims-innerbox label.ims-selected").removeClass(o);e(".ims-innerbox [type='checkbox']").removeAttr("checked");n.removeAttr("disabled");$submitdiv.removeClass("loading");$text=e(t).find("#ims-mainbox .ims-message");e("li.ims-menu-shopping-cart").replaceWith(e(t).find(".imstore-nav li.ims-menu-shopping-cart"));if(!$text.html()&&e("body.single-ims_image")[0])window.location.reload(true);else if($text.html()=="")u.find(".touch-close").trigger("click");else $submitdiv.prepend($text)})});e("body").delegate(".box-add-to-cart","click",function(){u.clear_cart_form();e(".ims-image-count em").html(1);u.find(".ims-message").remove();r=e(this).parents(".ims-slide").attr("id");if(!r){e(this).parent().find("input").attr({checked:"checked"});e(".add-images-to-cart a").trigger("click");return false}u.find(".touch-close").unbind("click").bind("click",function(){$slide=e("#"+r);$slide.find(".touch-shadow").show();$slide.find(".img-metadata").show();e("#ims-pricelist").hide().appendTo("body")});u.bind("touchstart",function(e){var t=e.originalEvent;var n=t.changedTouches[0].pageX;u.bind("touchmove",function(e){t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];if(Math.abs(t.pageX-n)>5)return false;u.unbind("touchmove")})});$slide=e("#"+r);$slide.find(".touch-shadow").hide();$slide.find(".img-metadata").hide();e("#ims-to-cart-ids").val(e(this).attr("id"));$slide.append(u.css({display:"inline-block"}));e(document).bind("touch_before_close touch_previous touch_next",a);return false});active=e(".ims-login-tags").attr("data-active");e(".ims-form:visible").hide();e("#ims-"+active+"-form").show();e(".form-tab-"+active).addClass("active");e(".ims-login-tags li").click(function(){e(".ims-form:visible").hide();e(".ims-login-tags li.active").removeClass("active");e(this).addClass("active");e(".ims-form").eq(e(".ims-login-tags li").index(e(this))).show();return false});e("#touch-overlay").delegate("label:has('input')","mousedown",function(){var t=e(this).parents(".ims-slide");var n=e(this).find('input[type="checkbox"]').val();var r=e('.ims-gallery input[value="'+n+'"]');var i=r.parents(".hmedia");if(t.hasClass(o)){r.removeAttr("checked");t.removeClass(o);i.removeClass(o)}else{t.addClass(o);i.addClass(o);r.attr({checked:"checked"})}})})