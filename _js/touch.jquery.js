/**
 * Image Store - jQuery touch plugin
 *
 * @file touch.jquery.js
 * @package Image Store
 * @author  Martin Angelov / Hafid Trujillo
 * @copyright 20010-2013
 * @url http://tutorialzine.com/2012/04/mobile-touch-gallery/
 * @filesource  wp-content/plugins/image-store/_js/touch.jquery.jquery.js
 * @since 3.2.1
 */

(function(e){var t=e('<div id="touch-overlay">'),n=e('<div id="touch-slider">'),r=e('<a id="touch-prev"></a>'),i=e('<a id="touch-next"></a>'),s=0,o=false;e.fn.imstouch=function(u){function d(e){setTimeout(function(){E(e)},1e3)}function v(t,n){e.event.trigger(t);if(n){n.call(e("#ims-slide-"+f))}}function m(t){return parseInt(e("#touch-slider .ims-slide").index(e("#ims-slide-"+t)))}function g(t){return parseInt(e(t).attr("class").replace(/^(.+)?(ims-touch-)([0-9]{1,})(.+)?$/g,"$3"))}function y(e){n.css("left",-e*100+"%")}function b(n){if(o){return false}if(p.href){e(p.href).find(".touch-close").bind("click",S)}t.show();setTimeout(function(){t.addClass("visible")},100);e(document).bind("keydown",function(e){if(e.keyCode===37){e.preventDefault();r.click()}else if(e.keyCode===39){e.preventDefault();i.click()}else if(e.keyCode==27)S()});y(n);o=true;v("touch_open",p.onOpen)}function w(t,n){var r=e('<img class="touch-shadow">').bind("load",function(){n.call(r);v("touch_image_loaded")});if(!("ontouchstart"in window))r.bind("click",x);r.attr("src",t)}function E(t){if(!e("#ims-slide-"+t)[0]){return false}if(p.href){if(!e(p.href).hasClass("touch-shadow"))e(p.href).addClass("touch-shadow");e("#ims-slide-"+t).html(e(p.href).css({display:"inline-block"}));return true}w(e(".ims-touch-"+t).attr("href"),function(){closelink=e('<a class="touch-close">x</a>').click(function(e){e.preventDefault();S()});if(e(".ims-touch-"+t).next(".img-metadata")[0]){title=e(".ims-touch-"+t).attr("title");e("#ims-slide-"+t).html(this).append(e(".ims-touch-"+t).next(".img-metadata").clone().prepend('<span class="image-title">'+title+"</span>").append(closelink))}else e("#ims-slide-"+t).html(this).append(e('<span class="img-metadata" ></span>').append(closelink))});if(!p.href){r.show();i.show()}}function S(){if(!o){return false}t.hide().removeClass("visible");o=false;if(p.href)e(p.href).hide().appendTo("body");else h.empty();r.hide();i.hide();e(document).unbind("keydown");tems=l;e(window).scrollTop(e(".ims-touch-"+f).offset().top-300);v("touch_close",p.onClose)}function x(){if(f+1<h.length){f++;y(m(f));d(f+1);v("touch_next")}else{n.addClass("rightSpring");setTimeout(function(){n.removeClass("rightSpring")},500)}}function T(){if(f>0){f--;y(m(f));d(f-1);v("touch_previous")}else{n.addClass("leftSpring");setTimeout(function(){n.removeClass("leftSpring")},500)}}var a="",f=0,l=this,c=l,h=e([]);var p=e.extend({href:false,onOpen:false,onClose:false},u);if(!e("#touch-overlay")[0]){t.hide().appendTo("body");n.appendTo(t)}closeOverlay=function(t){if(e(t.target).attr("class")!="ims-slide")return;S()};c.each(function(){e(this).addClass("ims-touch-"+s);a+='<div id="ims-slide-'+s+'" class="ims-slide"></div>';s++});n.append(h=e(a).bind("click",closeOverlay));e("#touch-overlay .ims-slide img").live("touchstart",function(e){var t=e.originalEvent,r=t.changedTouches[0].pageX;n.bind("touchmove",function(e){e.preventDefault();t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];if(t.pageX-r>10){n.unbind("touchmove");T()}else if(t.pageX-r<-10){n.unbind("touchmove");x()}});return false}).bind("touchend",function(){n.unbind("touchmove")});c.live("click",function(e){e.preventDefault();f=g(this);offset=m(f);b(offset);E(f);if(!p.href){d(f+1);d(f-1)}});if(!p.href){t.append(r).append(i);r.bind("click",function(e){e.preventDefault();T()});i.bind("click",function(e){e.preventDefault();x()});r.hide();i.hide()}}})(jQuery)