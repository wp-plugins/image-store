/**
 * Image Store - Admin gallery script
 *
 * @file imstore.js
 * @package Image Store
 * @author Hafid Trujillo
 * @copyright 20010-2013
 * @filesource  wp-content/plugins/image-store/_js/imstore.js
 * @since 0.5.0
 */

(function(e){e("img[data-ims-src]").bind("scrollin",{distance:20},function(){var e=this,t=jQuery(e),n=t.attr("data-ims-src");t.unbind("scrollin").hide().removeAttr("data-ims-src").attr("data-ims-loaded","true");e.src=n;t.fadeIn()})})(jQuery);jQuery(function(e){var t=e("#ims-mainbox");var n=e(".ims-message");var r=e("#ims-mainbox .ims-toolbar");if(r[0]){var i="ims-float";var s=[r,n];var o,u,a;setTimeout(function(){o=r.offset().top;a=t.height()},80);e(window).bind("scroll resize",function(){wscroll=e(window).scrollTop();if(wscroll>=o&&wscroll<a+o){n.hide();e.each(s,function(){this.addClass(i).css({width:e(".imstore-nav").innerWidth()-20})})}else{e.each(s,function(){this.removeClass(i).css({width:"auto"})})}})}e("body").delegate("li.ims-scroll-up","click",function(n){n.preventDefault();e("html,body").animate({scrollTop:t.offset().top-30})});e(".ims-img img, #ims-slideshow, .ims-thumb").bind("contextmenu",function(e){e.preventDefault()});display_user_message=function(e,t){n.fadeOut().removeClass("ims-error").removeClass("ims-success").addClass(t).html(e).fadeIn();if(n.hasClass("ims-float")){setTimeout(function(){n.fadeOut()},1500)}};img_ids_to_string=function(){return e(".ims-innerbox input:checked").map(function(){return e(this).val()}).get().join(",")};if(jQuery().xmslide){e(".ims-filmstrip").xmslide({paging:true});e(".ims-tools-gal").xmslide({paging:true});setTimeout(function(){e("#ims-simple-slideshow").xmslide({boxsize:1,paging:true,autostart:true})},200)}update_favorites_values=function(t){response=t.split("|");if(typeof response[2]!="undefined"){if(!e(".ims-menu-favorites span")[0])e(".ims-menu-favorites").append("<span>("+response[2]+")</span>");else e(".ims-menu-favorites span").html("("+response[2]+")");e(window).trigger("img_favorites_values",response)}display_user_message(response[0],response[1])};if(jQuery().imstouch){wpgalleries=imstore.wplightbox?",.gallery .gallery-icon a, a.colorbox, a.xmtouch":"";e("#ims-mainbox .ims-gallery:not(.nolightbox) .ims-img a.url,"+".ims-colorbox .ims-img a.url,"+".ims-preview a.url"+wpgalleries).imstouch({onOpen:function(){n.hide()}})}e("#ims-mainbox").delegate(".ims-innerbox label:has('input')","mousedown",function(){$parent=e(this).parents(".hmedia");if($parent.hasClass("ims-selected"))$parent.removeClass("ims-selected");else $parent.addClass("ims-selected")});e("body").delegate(".ims-select-all a","click",function(){e(".ims-innerbox label:has('input')").parents(".hmedia").addClass("ims-selected");e(".ims-innerbox [type='checkbox']").attr("checked","checked");return false});e("body").delegate(".ims-unselect-all a","click",function(){e(".ims-innerbox .hmedia.ims-selected").removeClass("ims-selected");e(".ims-innerbox [type='checkbox']").removeAttr("checked");return false});e("body").delegate(".add-to-favorite a","click",function(){img_ids=img_ids_to_string();e.get(imstore.imstoreurl+"/ajax.php",{imgids:img_ids,action:"favorites",_wpnonce:imstore.ajaxnonce},function(e){update_favorites_values(e)});return false});e("body").delegate(".add-to-favorite-single a","click",function(){if(e("#ims-thumbs li.selected")[0])$ids=e("#ims-thumbs li.selected").attr("data-id");else $ids=e('.img-metadata input[name="imgs[]"]').val();e.get(imstore.imstoreurl+"/ajax.php",{imgids:$ids,action:"favorites",_wpnonce:imstore.ajaxnonce},function(e){update_favorites_values(e)});e("body").animate({scrollTop:e(".ims-message").offset().top-50},"slow");return false});e("body").delegate(".remove-from-favorite a","click",function(){img_ids=img_ids_to_string();e(".ims-innerbox input:checked").each(function(){e(this).parents("dt,li,figure").remove()});count=e(".ims-innerbox .ims-img").length;e.get(imstore.imstoreurl+"/ajax.php",{count:count,imgids:img_ids,action:"remove-favorites",_wpnonce:imstore.ajaxnonce},function(t){response=t.split("|");if(typeof response[2]!="undefined")e(".ims-menu-favorites span").html("("+response[2]+")");display_user_message(response[0],response[1])});return false});e("body").delegate(".img-metadata .rating","click",function(t){if(!imstore.is_logged_in&&!imstore.gallery_user){selector=".ims-not-allowed";if(!e(selector)[0])e("body").append('<div class="'+selector.replace(".","")+'"></div>');e(".touch-close").trigger("click");e(selector).hide().bind("click",function(){e(this).fadeOut()}).html("<aside>"+"The email has been sent"+"</aside>").fadeIn().delay(1500).fadeOut();return}button=e(this).addClass("cliked");ajaxaction=button.hasClass("ims-voted")?"remove-vote":"vote";e.get(imstore.imstoreurl+"/ajax.php",{action:ajaxaction,_wpnonce:imstore.ajaxnonce,gallery_user:imstore.gallery_user,imgid:e(this).attr("data-id")},function(e){if(!e)return;button.fadeOut().html('<em class="value">'+e+"</em>").fadeIn();if(ajaxaction=="vote")button.addClass("ims-voted");else button.removeClass("ims-voted")});return false});e(".ims-color").click(function(){val=e(this).val();color=e(this).is(":checked")?"&c="+val:"";e(".image-color input").not(".ims-color-"+val).removeAttr("checked");e(".image-wrapper img").animate({opacity:0},400,function(){img=new Image;img.src=f.currentImage.image.src+color;e(".image-wrapper img").replaceWith(img).delay(900/1.5).animate({opacity:1},700)})});if(e("#ims-thumbs")[0]&&imstore.galleriffic&&jQuery().galleriffic){var f=e("#ims-thumbs").galleriffic({preloadAhead:10,enableTopPager:true,enableBottomPager:true,renderSSControls:true,renderNavControls:true,controlsContainerSel:"#ims-player",captionContainerSel:"#ims-caption",imageContainerSel:"#ims-slideshow",numThumbs:parseInt(imstore.numThumbs),maxPagesToShow:parseInt(imstore.maxPagesToShow),playLinkText:imstore.playLinkText,pauseLinkText:imstore.pauseLinkTex,prevLinkText:imstore.prevLinkText,nextLinkText:imstore.nextLinkText,delay:parseInt(imstore.slideshowSpeed),nextPageLinkText:imstore.nextPageLinkText,prevPageLinkText:imstore.prevPageLinkText,autoStart:imstore.autoStart,defaultTransitionDuration:parseInt(imstore.transitionTime),onSlideChange:function(t,n){e(".ims-slideshow-tools [type='checkbox']").removeAttr("checked")},onCreateImage:function(e){e.image.onload="";return e}})}})